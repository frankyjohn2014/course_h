"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function containsClass(e,t){return!(!e||"string"!=typeof t)&&!!(e.className&&e.className.trim().split(/\s+/gi).indexOf(t)>-1)}function debounced(e,t){var o;return function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];o&&clearTimeout(o),o=setTimeout((function(){e.apply(void 0,n),o=null}),t)}}function apiForAddBookmark(e){ajax("/api/bookmarks","POST",{course_id:e.getAttribute("data-course-id"),user_id:e.getAttribute("data-user-id")}).then((function(t){e.classList.add("course-action-bookmark-active"),e.querySelector("i").classList.remove("icon-heart"),e.querySelector("i").classList.add("icon-heart-full"),t.id&&e.setAttribute("data-bookmark-id",t.id),t?console.log("Добавлена закладка"):alert("Эта закладка уже существует")})).catch((function(e){console.error(e)}))}function apiForRemoveBookmark(e){ajax("/api/bookmarks/"+e.getAttribute("data-bookmark-id"),"DELETE").then((function(){e.classList.remove("course-action-bookmark-active"),e.querySelector("i").classList.remove("icon-heart"),e.querySelector("i").classList.add("icon-heart-full"),e.removeAttribute("data-bookmark-id"),console.log("Закладка удалена")})).catch((function(e){console.error(e)}))}function apiForRemoveHistory(e){ajax("/api/history/"+e.getAttribute("data-history-id"),"DELETE").then((function(){var t=e.closest(".course");t&&t.remove(),console.log("курс удален из истории")})).catch((function(e){console.error(e)}))}function renderSearchList(e,t){t.innerHTML="";var o="";e.courses&&e.courses.length&&(o+='<div class="main-search-result-title">Курсы</div>',o+=e.courses.map((function(e){return'<a href="/course/'.concat(e.slug,'" class="main-search-result-item"><picture class="main-search-picture"><img src="').concat(e.poster_uri||"/images/no-logo.svg",'" alt="').concat(e.title,'" class="main-search-img"></picture>').concat(e.title,"</a>")})).join("")),e.sources&&e.sources.length&&(o+='<div class="main-search-result-title">Источники</div>',o+=e.sources.map((function(e){return'<a href="/source/'.concat(e.slug,'" class="main-search-result-item"><picture class="main-search-picture"><img src="').concat(e.logo||"/images/no-logo.svg",'" alt="').concat(e.title,'" class="main-search-img"></picture>').concat(e.title,"</a>")})).join("")),t.innerHTML=o}function ajax(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer "+Cookies.get("accessToken")},redirect:"follow",referrer:"no-referrer"};return"DELETE"===t&&"GET"===t||(r.body=JSON.stringify(o)),fetch(e,r).then((function(e){return"DELETE"!==t?e.json():e})).catch((function(e){return e}))}function ratingVote(e){ajax("/course_rate","POST",{course_id:e.currentTarget.getAttribute("data-course-id"),vote:e.currentTarget.getAttribute("data-vote"),user_id:e.currentTarget.getAttribute("data-user-id")}).then((function(t){if(t&&t.neg&&t.pos){var o=e.target.closest(".rang");o.querySelector(".good").innerText=t.pos,o.querySelector(".bad").innerText=t.neg}}))}function dropOpen(e){var t=e.currentTarget.parentElement;if(t.classList)t.classList.add("drop-active");else{var o=t.className.split(" ");o.push("drop-active"),t.className=o.join(" ")}}function dropClose(e){var t=e.currentTarget.parentElement;if(t.classList)t.classList.remove("drop-active");else{var o=t.className.split(" "),r=o.indexOf("drop-active");r>=0&&o.splice(r,1),t.className=o.join(" ")}}!function(e){var t=!1;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=e(),t=!0),!t){var o=window.Cookies,r=window.Cookies=e();r.noConflict=function(){return window.Cookies=o,r}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var o=arguments[e];for(var r in o)t[r]=o[r]}return t}return function t(o){function r(t,n,a){var i;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(a=e({path:"/"},r.defaults,a)).expires){var c=new Date;c.setMilliseconds(c.getMilliseconds()+864e5*a.expires),a.expires=c}a.expires=a.expires?a.expires.toUTCString():"";try{i=JSON.stringify(n),/^[\{\[]/.test(i)&&(n=i)}catch(e){}n=o.write?o.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var s="";for(var u in a)a[u]&&(s+="; "+u,!0!==a[u]&&(s+="="+a[u]));return document.cookie=t+"="+n+s}t||(i={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,p=0;p<l.length;p++){var m=l[p].split("="),f=m.slice(1).join("=");this.json||'"'!==f.charAt(0)||(f=f.slice(1,-1));try{var v=m[0].replace(d,decodeURIComponent);if(f=o.read?o.read(f,v):o(f,v)||f.replace(d,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(t===v){i=f;break}t||(i[v]=f)}catch(e){}}return i}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,o){r(t,"",e(o,{expires:-1}))},r.withConverter=t,r}((function(){}))})),document.addEventListener("touchstart",(function(e){}),{passive:!0}),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js").then((function(e){console.log("SW reg successful with scope: ",e.scope)}),(function(e){console.log("ServiceWorker registration failed: ",e)}))})),window.addEventListener("offline",(function(e){console.log(e)}),!1),window.addEventListener("online",(function(e){console.log(e)}),!1),window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,o=(this.document||this.ownerDocument).querySelectorAll(e),r=this;do{for(t=o.length;--t>=0&&o.item(t)!==r;);}while(t<0&&(r=r.parentElement));return r}),console.log("%cCourseHunter!","font-weight:bold;font-size:50px;color:red;text-shadow:3px 3px 0 rgb(217,31,38),6px 6px 0 rgb(226,91,14),9px 9px 0 rgb(245,221,8),12px 12px 0 rgb(5,148,68),15px 15px 0 rgb(2,135,206),18px 18px 0 rgb(4,77,145),21px 21px 0 rgb(42,21,113)"),document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementsByClassName("language-item");e&&Array.prototype.forEach.call(e,(function(e){e.addEventListener("click",(function(e){var t=e.target.getAttribute("data-title");Cookies.set("locale",t),window.location.reload()}))}));var t=document.getElementsByClassName("course"),o=document.getElementsByClassName("sources-item"),r=document.getElementsByClassName("categories-item"),n=document.getElementById("localSearch"),a=function(e,t){for(var o=0,r=e.length;o<r;o++)e[o].getAttribute("data-name").toLowerCase().includes(t)?e[o].removeAttribute("hidden"):e[o].setAttribute("hidden","")};if(n){var i=n.closest("form");i&&i.addEventListener("submit",(function(e){e.preventDefault()})),n.addEventListener("keyup",(function(e){var n=e.target.value.trim();t&&a(t,n.toLowerCase()),t&&a(o,n.toLowerCase()),t&&a(r,n.toLowerCase())}))}var c=document.querySelector(".course-wrap-description");c&&c.addEventListener("click",(function(e){e.currentTarget.classList.add("course-wrap-description-opened")}));var s=document.querySelectorAll(".drop");s&&s.length&&Array.prototype.forEach.call(s,(function(e){e.addEventListener("mouseover",dropOpen,!1),e.addEventListener("mouseout",dropClose,!1)}));var u=document.querySelectorAll(".drop-target");u&&u.length&&Array.prototype.forEach.call(u,(function(e){e.addEventListener("click",(function(e){window.innerWidth<768&&(e.preventDefault(),e.stopPropagation())}))}));var l=document.getElementById("positive-rank");l&&l.addEventListener("click",ratingVote);var d=document.getElementById("negative-rank");d&&d.addEventListener("click",ratingVote);var p=document.querySelectorAll(".theme-btn");p&&p.length&&Array.prototype.forEach.call(p,(function(e){e&&e.addEventListener("click",(function(e){"light"===e.target.getAttribute("data-title")?Cookies.set("theme_light",!0):Cookies.set("theme_light",!1),window.location.reload()}))}));var m=document.querySelectorAll(".course-figure");m&&m.length&&Array.prototype.forEach.call(m,(function(e){e.addEventListener("click",(function(e){window.location.href=e.currentTarget.getAttribute("data-link")}))}));var f=document.querySelectorAll(".course-primary-name");f&&f.length&&Array.prototype.forEach.call(f,(function(e){e.addEventListener("click",(function(e){window.location.href=e.currentTarget.getAttribute("data-link")}))}));var v=document.querySelectorAll(".course-action");v&&v.length&&Array.prototype.forEach.call(v,(function(e){e&&e.addEventListener("click",(function(e){var t=e.currentTarget;containsClass(t,"course-action-bookmark-active")?apiForRemoveBookmark(t):containsClass(t,"course-action-bookmark")?apiForAddBookmark(t):containsClass(t,"course-action-history-remove")&&apiForRemoveHistory(t)}))}));var g=document.querySelector(".search-home");g&&(document.addEventListener("keyup",(function(e){27===e.keyCode&&g.classList.remove("search-active")})),g.addEventListener("click",(function(){g.classList.add("search-active")})),document.addEventListener("click",(function(e){e.target.closest(".search-home")||g.classList.remove("search-active")})));var h=document.getElementById("pageSearch"),y=document.querySelector(".search-result");if(h&&y){h.addEventListener("keyup",debounced((function(e){e.preventDefault();var t=e.target.value,o=new XMLHttpRequest;o.withCredentials=!0,o.addEventListener("readystatechange",(function(){4===this.readyState&&renderSearchList(JSON.parse(this.responseText),y)})),o.open("GET","/api/suggestions?query="+encodeURIComponent(t)),o.setRequestHeader("accept","application/json"),o.setRequestHeader("Authorization","Bearer "+Cookies.get("accessToken")),o.setRequestHeader("Accept","*/*"),o.send()}),400))}var k=document.querySelector(".main-search");k&&(document.addEventListener("keyup",(function(e){27===e.keyCode&&k.classList.remove("search-active")})),k.addEventListener("click",(function(){k.classList.add("search-active")})),document.addEventListener("click",(function(e){e.target.closest(".main-search")||k.classList.remove("search-active")})));var E=document.getElementById("mainSearch"),L=document.querySelector(".main-search-result");if(E&&L){E.addEventListener("keyup",debounced((function(e){e.preventDefault();var t=e.target.value,o=new XMLHttpRequest;o.withCredentials=!0,o.addEventListener("readystatechange",(function(){4===this.readyState&&renderSearchList(JSON.parse(this.responseText),L)})),o.open("GET","/api/suggestions?query="+encodeURIComponent(t)),o.setRequestHeader("accept","application/json"),o.setRequestHeader("Authorization","Bearer "+Cookies.get("accessToken")),o.setRequestHeader("Accept","*/*"),o.send()}),400))}}));